<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Sidekiq: Sidekiq Transport Layer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="epiq_55px.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Sidekiq
   </div>
   <div id="projectbrief">Software Defined Radio card</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Sidekiq Transport Layer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page is a discussion of the existing Sidekiq transport layers available to developers and includes options for implementing and using a custom transport layer.</p>
<h1><a class="anchor" id="STLOverview"></a>
Overview</h1>
<p>Sidekiq was developed under the assumption that there would always be either a PCIe or USB interface available to connect the host system and the card itself. This has worked out reasonably well up until now, with a common libsidekiq library capable of supporting either of these interfaces. Most developers will only need to use the "stock" transport layers. The software/FPGA architecture for using PCIe as the transport interface is shown below.</p>
<div class="image">
<img src="sidekiq_software_fpga_block_diagram.png" alt="sidekiq_software_fpga_block_diagram.png"/>
</div>
 <p>However, for some applications, it is necessary to provide a custom transport interface between libsidekiq and the FPGA. In this case, the architecture to support this would need to have a custom software layer at the bottom of the software stack, as well as a custom FPGA interface. Hosting a Sidekiq card in custom hardware may benefit from a custom transport layer. This alternate architecture with a custom transport is shown below.</p>
<div class="image">
<img src="sidekiq_software_fpga_alternate_transport_block_diagram.png" alt="sidekiq_software_fpga_alternate_transport_block_diagram.png"/>
</div>
 <h1><a class="anchor" id="CTInterface"></a>
Custom Transport Interface</h1>
<p>Support for a custom transport implementation is available in the latest libsidekiq release starting with v3.2.0 and necessitates the development of three new software/FPGA components. This is detailed in the sections below.</p>
<ul>
<li><b>libsidekiq:</b> This is the primary library that supports the use of a separate external transport implementation. The existing PCIe and USB transport layers used by libsidekiq are already bundled with libsidekiq and are available for use by applications. Applications that wish to use a custom transport implementation may enhance their application by registering the custom transport implementation (<a class="el" href="sidekiq__xport__api_8h.html#a299c492f40d86695f14426f10a243af1">skiq_register_custom_transport()</a>) and initializing libsidekiq to use that custom transport (skiq_init_xport()).<ul>
<li><code>int32_t skiq_register_custom_transport(<a class="el" href="structskiq__xport__card__functions__t.html">skiq_xport_card_functions_t</a> * functions)</code> - This function performs registration of all the required card function pointers so that libsidekiq knows which functions should be called in the custom transport implementation for the required transport operations. Card functions (probe, init, exit) are registered with this function. Probe and init functions can register functions related to FPGA, RX, and TX functionality depending on a custom transport's capability. This includes functions for reading/writing FPGA registers, starting/stopping streaming, receiving contiguous blocks of samples, and flushing the transport. See the <a class="el" href="CustomTransport.html#CTImplementationGuide">Sidekiq Custom Transport Implementation Guide</a> section in Sidekiq API documentation for more details.</li>
<li><code>int32_t skiq_init ( skiq_xport_type_t type, skiq_xport_init_level_t level, uint8_t * p_card_nums, uint8_t num_cards )</code></li>
<li>This function is used to initialize the library and cards. If using the custom transport implementation, the transport functions must be registered prior to calling this API. The specified level may be ' <a class="el" href="sidekiq__xport__types_8h.html#ae503c6fb82bfbab0b938c3aad1351ce5a69667a04fdc83a252a3fa1da42433d95">basic</a>' where only FPGA related functions are registered, or '<a class="el" href="sidekiq__xport__types_8h.html#ae503c6fb82bfbab0b938c3aad1351ce5a7a169230e19f0a50dc4af73e2e048927">full</a>'where RX / TX streaming related functions are registered. See the Sidekiq API documentation for more details on this function and related enumerations.</li>
</ul>
</li>
<li><b>Custom SW "Driver"</b>: This is the Linux kernel space driver that may be required by the custom transport layer to support both register and streaming operations with hardware. The assumption here is that the custom transport implementation calls this software interface to provide the physical transport between the CPU and the FPGA.</li>
<li><b>Custom FPGA Interface</b>: This is the FPGA block that manages both the register and streaming interfaces on the FPGA. The assumption here is that the vast majority of the stock Sidekiq FPGA reference design will be preserved, replacing only the PCIe/DMA interface currently provided by Northwest Logic with the custom transport interface.</li>
</ul>
<h1><a class="anchor" id="CTImplementationGuide"></a>
Custom Transport Implementation Guide</h1>
<h2><a class="anchor" id="Overview"></a>
Overview</h2>
<p>The current implementation of custom FPGA transport support has the ability to perform register transactions as well as receive sample streaming. While the transmit sample streaming hooks are in place, a custom transport implementation may leave them at their defaults. This release is based on libsidekiq v3.1.0 and adds the custom FPGA transport support and is planned to be released as libsidekiq v3.2.0.</p>
<h2><a class="anchor" id="TransportImplementation"></a>
Transport Implementation</h2>
<p>In the SDK's top-level directory there are two new directories that have example implementations. The first, <b>custom_xport_bare</b>, is a simple stub example where all functions print their parameters and return success. This example can be used as a basis for new work. The second example, <b>custom_xport_example</b>, is the PCIe transport layer implementation and can be compiled and referenced as a complete example.</p>
<h2><a class="anchor" id="Compiling"></a>
Compiling the Transport Implementation</h2>
<ol type="1">
<li>Change directory to either <b>custom_xport_bare</b> or <b>custom_xport_example</b> </li>
<li>Type <code>make BUILD_CONFIG=x86_64.gcc</code></li>
</ol>
<p>This builds the custom transport and some example test applications. A test application's object file is linked with the custom transport object(s) and libsidekiq's static library. The example test applications are the same as their test_apps counterpart with the exception of calling <a class="el" href="sidekiq__xport__api_8h.html#a299c492f40d86695f14426f10a243af1">skiq_register_custom_transport()</a>, and specifying <a class="el" href="sidekiq__xport__types_8h.html#aa7040bac01c1f8902cac8c5a74ed0120a008721c3a44964752a84d33e190b1aa3">skiq_xport_type_custom</a> in calls to <a class="el" href="group__cardfunctions.html#ga31e8d3319d985cfedba7556d7b758554">skiq_init()</a>.</p>
<h2><a class="anchor" id="API"></a>
API</h2>
<p>Below is a summary of the function sets that should be supported by the transport library.</p>
<h2><a class="anchor" id="CardFunctions"></a>
Card Functions</h2>
<p>All three card functions are required for a custom transport implementation. Pointers to the functions are collected into a <a class="el" href="structskiq__xport__card__functions__t.html">skiq_xport_card_functions_t</a> struct and passed to <a class="el" href="sidekiq__xport__api_8h.html#a299c492f40d86695f14426f10a243af1">skiq_register_custom_transport()</a> function before calling skiq_init_xport().</p>
<ul>
<li><code>int32_t (*card_probe)( uint64_t *p_uid_list, uint8_t *p_num_cards );</code></li>
<li><code>int32_t (*card_init)( skiq_xport_init_level_t level, uint64_t xport_uid );</code></li>
<li><code>int32_t (*card_exit)( skiq_xport_init_level_t level, uint64_t xport_uid );</code></li>
</ul>
<p>The <a class="el" href="structskiq__xport__card__functions__t.html#card_probe">card_probe</a> and <a class="el" href="structskiq__xport__card__functions__t.html#card_init">card_init</a> are responsible for further registering the remaining transport function sets (FPGA, RX, and TX) based on the caller's <a class="el" href="sidekiq__xport__types_8h.html#ae503c6fb82bfbab0b938c3aad1351ce5">skiq_xport_init_level_t</a> request and the card's capabilities. Refer to the <b>custom_xport_bare</b> example.</p>
<h2><a class="anchor" id="FPGAFunctions"></a>
FPGA Functions</h2>
<p>The FPGA functions implement transporting requests to read / write registers as well as bringing up / down the transport link to the FPGA (for reprogramming). Pointers to the functions are collected into a <a class="el" href="structskiq__xport__fpga__functions__t.html">skiq_xport_fpga_functions_t</a> struct and registered on a per-card basis by calling <a class="el" href="sidekiq__xport__api_8h.html#af7df60b4ca2cf7f3b8ad3414a65eb6ee">xport_register_fpga_functions()</a>.</p>
<ul>
<li><code>int32_t (<em>fpga_reg_read)( uint64_t xport_uid, uint32_t addr, uint32_t</em> p_data );</code></li>
<li><code>int32_t (*fpga_reg_write)( uint64_t xport_uid, uint32_t addr, uint32_t data );</code></li>
<li><code>int32_t (*fpga_down)( uint64_t xport_uid );</code></li>
<li><code>int32_t (*fpga_up)( uint64_t xport_uid );</code></li>
</ul>
<h2><a class="anchor" id="RXFunctions"></a>
RX Functions</h2>
<p>The RX functions implement preparing the transport link for starting, stopping, pausing, and resuming receive sample data streaming as well as flushing buffered receive data and transporting receive sample data. Pointers to the functions are collected into a <a class="el" href="structskiq__xport__rx__functions__t.html">skiq_xport_rx_functions_t</a> struct and registered on a per-card basis by calling <a class="el" href="sidekiq__xport__api_8h.html#a49d4d7de410fc47ef1f725338bade425">xport_register_rx_functions()</a>.</p>
<ul>
<li><code>int32_t (*rx_start_streaming)( uint64_t xport_uid, skiq_rx_hdl_t hdl );</code></li>
<li><code>int32_t (*rx_stop_streaming)( uint64_t xport_uid, skiq_rx_hdl_t hdl );</code></li>
<li><code>int32_t (*rx_pause_streaming)( uint64_t xport_uid );</code></li>
<li><code>int32_t (*rx_resume_streaming)( uint64_t xport_uid );</code></li>
<li><code>int32_t (*rx_flush)( uint64_t xport_uid );</code></li>
<li><code>int32_t (*rx_receive)( uint64_t xport_uid, uint8_t **pp_data, uint32_t *p_data_len );</code></li>
</ul>
<h2><a class="anchor" id="TXFunctions"></a>
TX Functions</h2>
<p>The TX functions implement preparing the transport link for starting and stopping transmit sample data as well as transporting transmit sample data. Pointers to the functions are collected into a <a class="el" href="structskiq__xport__tx__functions__t.html">skiq_xport_tx_functions_t</a> struct and registered on a per-card basis by calling <a class="el" href="sidekiq__xport__api_8h.html#a95a97e64c4d1a390e7ccd7f0393ec7d3">xport_register_tx_functions()</a>.</p>
<ul>
<li><code>int32_t (*tx_initialize)( uint64_t xport_uid, skiq_tx_transfer_mode_t tx_transfer_mode, uint32_t num_bytes_to_send, uint8_t num_send_threads, void (*tx_complete_cb)(int32_t status, uint32_t *p_data) );</code></li>
<li><code>int32_t (*tx_start_streaming)( uint64_t xport_uid, skiq_tx_hdl_t hdl );</code></li>
<li><code>int32_t (*tx_pre_stop_streaming)( uint64_t xport_uid, skiq_tx_hdl_t hdl );</code></li>
<li><code>int32_t (*tx_stop_streaming)( uint64_t xport_uid, skiq_tx_hdl_t hdl );</code></li>
<li><code>int32_t (*tx_transmit)( uint64_t xport_uid, skiq_tx_hdl_t hdl, int32_t *p_samples, void *p_private );</code></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>It is NOT recommended to use <a class="el" href="sidekiq__xport__api_8h.html#af7df60b4ca2cf7f3b8ad3414a65eb6ee">xport_register_fpga_functions()</a>, <a class="el" href="sidekiq__xport__api_8h.html#a49d4d7de410fc47ef1f725338bade425">xport_register_rx_functions()</a>, <a class="el" href="sidekiq__xport__api_8h.html#a95a97e64c4d1a390e7ccd7f0393ec7d3">xport_register_tx_functions()</a>, <a class="el" href="sidekiq__xport__api_8h.html#a8ae034b576fa8d586730d3b2fc68130e">xport_unregister_fpga_functions()</a>, <a class="el" href="sidekiq__xport__api_8h.html#aa3f250b7c1ec569332c1a433e9f3b03c">xport_unregister_rx_functions()</a>, or <a class="el" href="sidekiq__xport__api_8h.html#aadddcffe02ed92691dfaa5829972c08f">xport_unregister_tx_functions()</a> from functions other than the <a class="el" href="structskiq__xport__card__functions__t.html#card_init">card_init</a> and <a class="el" href="structskiq__xport__card__functions__t.html#card_exit">card_exit</a> implementations. </dd></dl>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<!-- <hr class="footer"/><address class="footer"><small> -->
<!-- Generated by &#160;<a href="http://www.doxygen.org/index.html"> -->
<!-- <img class="footer" src="doxygen.png" alt="doxygen"/> -->
<!-- </a> 1.8.6 -->
<!-- </small></address> -->
<div align="center"><pre>Copyright 2013-2024 Epiq Solutions, All Rights Reserved</pre></div>
</body>
</html>
